# Express & SQL w. Knex: Update & Delete

## Adding a Database to our Express App

## Rebuild Bookmarks

## Getting Started

- get your express server running
- make sure postgres is running
- in the browser go to the index route and check that it works

## Delete

**IMPORTANT:** One thing that will be different with your builds is that instead of using the array position, we will be using each item's unique `id` that is generated by Postgres.

For example, looking at the data we inserted `Apartment Therapy` should have an `id` of `2`

![](./assets/id-not-array-index.png)

If we were to access it by array position it would be at array position `1`. We did this earlier for simplicity. However, there is never a guarantee that an item will be in a certain order/array position and it can change. So using the `id`, now that we have a database is critical.

## Delete

**queries/bookmarks.js**

Create an async arrow function and be sure to include it in `module.exports`

```js
const deleteBookmark = async (id) => {
  try {
  } catch (err) {
    return err;
  }
};

module.exports = {
  getAllBookmarks,
  getBookmark,
  newBookmark,
  deleteBookmark,
};
```

```js
const deleteBookmark = async (id) => {
  try {
    const deletedBookmark = await db.one(
      "DELETE FROM bookmarks WHERE id = $1 RETURNING *",
      id
    );
    return deletedBookmark;
  } catch (err) {
    return err;
  }
};
```

**controllers/bookmarkController.js**
Import the function

```js
const {
  getAllBookmarks,
  getBookmark,
  newBookmark,
  deleteBookmark,
} = require("../queries/bookmarks");
```

Create the delete route and test it with Postman

Remember to have:

- route DELETE /bookmarks/:id

Test that the route works:

```js
// DELETE
bookmarks.delete("/:id", async (req, res) => {
  const { id } = req.params;
  res.status(200).json({ id });
});
```

Now add the database call:

```js
// DELETE
bookmarks.delete("/:id", async (req, res) => {
  const { id } = req.params;
  const deletedBookMark = await deleteBookmark(id);
  res.status(200).json(deletedBookMark);
});
```

## Update

**queries/bookmarks.js**

Create an async arrow function and be sure to include it in `module.exports`

```js
const updateBookmark = async (bookmark) => {
  try {
  } catch (err) {
    return err;
  }
};

module.exports = {
  getAllBookmarks,
  getBookmark,
  newBookmark,
  deleteBookmark,
  updateBookmark,
};
```

```js
const deleteBookmark = async (id) => {
const updateBookmark = async (bookmark) => {
  try {
    const updatedBookmark = await db.one(
      "UPDATE bookmarks SET name=$1, url=$2, category=$3, is_favorite=$4 where id=$5 RETURNING *",
      [
        bookmark.name,
        bookmark.url,
        bookmark.category,
        bookmark.is_favorite,
        bookmark.id,
      ]
    );
    return updatedBookmark;
  } catch (err) {
    return err;
  }
};
```

**controllers/bookmarkController.js**
Import the function

```js
const {
  getAllBookmarks,
  getBookmark,
  newBookmark,
  deleteBookmark,
  updateBookmark,
} = require("../queries/bookmarks");
```

Create the delete route and test it with Postman

Remember to have:

- route DELETE /bookmarks/:id

Test that the route works:

```js
// UPDATE
bookmarks.put("/:id", async (req, res) => {
  const { id } = req.params;
  res.status(200).json({ id });
});
```

Now add the database call:

```js
// UPDATE
bookmarks.put("/:id", async (req, res) => {
  const { id } = req.params;
  const updatedBookmark = await updateBookmark(id, req.body);
  res.status(200).json(updatedBookmark);
});
```

## Lab time!

Continue with Tuner
